</section>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<!--[if lt IE 9]>
<script>
document.createElement('header');
document.createElement('nav');
document.createElement('section');
document.createElement('article');
document.createElement('aside');
document.createElement('footer');
document.createElement('hgroup');
</script>
<![endif]-->

<script>
	if (navigator.userAgent.indexOf('Mac OS') != -1) {
		$('body').addClass('mac');
	}

	$(function() {
		var toc = $('#toc');
		var tocInner = $('div', toc);
		var docs = $('#docs');
		var file = location.pathname.split('/').pop();

		function tocHeight() {
			tocInner.height(toc.height());
		}
		

		$(window).resize(tocHeight);
		tocHeight();

		function tocItem(item, group) {
			var label = item.children().first().text();
			var el = $('<li><a href="#' + item.attr('id') + '">' + label + '</a></li>');

			el.appendTo(group);
			el.append(buildToc(item));

			$('a', el).click(function() {
				$('ul.sub-menu li.selected').removeClass('selected');
				$(this).parent().addClass('selected');
			});
		}

		function buildToc(root) {
			var sections = $('> section', root);

			if (!sections.length) {
				return;
			}

			var group = $('<ul class="sub-menu"></ul>');

			sections.each(function(idx, item) {
				tocItem($(item), group);
			});

			return group;

		}

		$('li a', toc).each(function(idx, item) {
			item = $(item);
			var url = $(item).attr('href');
			var subMenu;

			if (file == url || (!file && url == 'index.html')) {
				subMenu = buildToc(docs);

				item.parent()
					.addClass('selected')
					.append(subMenu)
				;

				// subMenu.show(500);
				return false;
			}
		});
	});
</script>